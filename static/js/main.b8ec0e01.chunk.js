(this["webpackJsonpdungeondraft-tag-app"]=this["webpackJsonpdungeondraft-tag-app"]||[]).push([[0],{1046:function(e,t,a){},1047:function(e,t,a){},1048:function(e,t,a){"use strict";a.r(t);a(546);var n=a(0),s=a.n(n),i=a(16),l=a.n(i),o=(a(653),a(1084)),r=(a(654),a(1081)),h=a(1082),g=a(115),c=a(1083),u=a(1085),d=a(158),p=a(1079),m=a(1080),f=a(1091),y=a(533),b=a.n(y),E=a(534),C=a.n(E),T=a(535),w=a.n(T),F=a(518),v=a.n(F),S=a(519),x=a(520),L=new(function(){function e(){Object(S.a)(this,e),this.ENABLE_LOGGING=!1}return Object(x.a)(e,[{key:"log",value:function(){this.ENABLE_LOGGING&&console.log.apply(null,arguments)}},{key:"time",value:function(){this.ENABLE_LOGGING&&console.time.apply(null,arguments)}},{key:"timeEnd",value:function(){this.ENABLE_LOGGING&&console.timeEnd.apply(null,arguments)}}]),e}());a(668);var O=function(e){return s.a.createElement("input",{id:"myInput",type:"file",webkitdirectory:"true",directory:"true",onChange:function(t){e.onChange(t.target.files)}})},N=a(521),D=a.n(N),I=a(525),P=a.n(I);a(759);class j extends s.a.Component{constructor(e){super(e),this.state={data:[]},this.cloneFileListToTableData=this.cloneFileListToTableData.bind(this),this.handleSelectionChange=this.handleSelectionChange.bind(this)}componentDidMount(){L.log("FileListChooser:componentDidMount"),L.log("  -> this.props.files",this.props.files),this.props.files&&(L.log("  -> Files Supplied...Replacing Component State Data..."),this.setState((e,t)=>({data:this.cloneFileListToTableData(t.files,t.alreadyChosenPaths,t.canSelect)})))}componentDidUpdate(e){L.log("FileListChooser:componentDidUpdate"),L.log("  -> prevProps",e),L.log("  -> prevProps",e),L.log("  -> this.props.files",this.props.files),e.files===this.props.files&&P()(e.alreadyChosenPaths,this.props.alreadyChosenPaths)&&e.canSelect===this.props.canSelect||(L.log("  -> Changing...Replacing Component State Data..."),this.setState((e,t)=>({data:this.cloneFileListToTableData(t.files,t.alreadyChosenPaths,t.canSelect)})))}cloneFileListToTableData(e,t,a){L.log("FileListChooser:this.cloneFileListToTableData");let n=[...e].map((e,n)=>({name:e.name,webkitRelativePath:e.webkitRelativePath,type:e.type,lastModified:e.lastModified,size:e.size,index:n,tableData:{checked:t.includes(e.webkitRelativePath),disabled:!a}}));return L.log("  -> new tableData",n),n}handleSelectionChange(e){L.log("FileListChooser:handleSelectionChange"),L.time("FileListChooser:handleSelectionChange"),this.props.onSelectionChange(e.map(e=>e.webkitRelativePath)),L.timeEnd("FileListChooser:handleSelectionChange")}getImageForIndex(e){return s.a.createElement("img",{alt:"Object",src:URL.createObjectURL(this.props.files[e]),style:{maxWidth:120}})}render(){return s.a.createElement(D.a,{title:"",options:{selection:!0,searchFieldAlignment:"left",paging:!1,maxBodyHeight:600,selectionProps:e=>({disabled:e.tableData.disabled})},onSelectionChange:this.handleSelectionChange,columns:[{title:"Name",field:"name"},{title:"Location",field:"webkitRelativePath"},{title:"Image",field:"webkitRelativePath",render:e=>this.getImageForIndex(e.index)}],data:this.state.data})}}j.defaultProps={canSelect:!0};var k=j,A=a(474),G=a(1087),B=a(1092);a(760);const R=Object(G.a)();class W extends s.a.Component{render(){return s.a.createElement(B.a,{selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,id:"TagPicker",value:this.props.tag,onChange:(e,t)=>{"string"===typeof t?this.props.onTagChange(t):t&&t.inputValue&&this.props.onNewTag(t.inputValue)},options:this.props.tagList,renderOption:e=>"string"===typeof e?e:e.title,filterOptions:(e,t)=>{const a=R(e,t),n=e.find(e=>e===t.inputValue);return""===t.inputValue||n||a.push({inputValue:t.inputValue,title:'Create New Tag "'.concat(t.inputValue,'"')}),a},style:{width:300},renderInput:e=>s.a.createElement(A.a,Object.assign({},e,{label:"Choose/Create a tag",variant:"outlined"}))})}}var _=W,J=a(476),U=a(1089),V=a(1088),M=a(526),z=(a(761),a(340));const H=a(149).a[600];class Y extends s.a.Component{downloadTagFile(e){var t=new Blob([e],{type:'text/text;charset=utf-8"'});Object(M.saveAs)(t,"default.dungeondraft_tags")}render(){const e=JSON.stringify(this.props.contents,null,"\t");return s.a.createElement(z.a,null,s.a.createElement(f.a,{severity:"info"},'Note when saving - some browsers and operating systems will automatically add an unwanted extension to the filename. If this happens, rename the file to "default.dungeondraft_tags"'),s.a.createElement(J.a,{variant:"contained",color:"secondary",onClick:()=>{this.downloadTagFile(e)}},"Download Tag File"),s.a.createElement(U.a,{language:"javascript",style:V.a,customStyle:{height:500},showLineNumbers:"true",showInlineLineNumbers:"true",lineNumberStyle:{color:H}},e))}}var K=Y,$=a(362),q=a(528),Q=a.n(q),X=a(529),Z=a.n(X),ee=a(530),te=a.n(ee),ae=a(531),ne=a.n(ae),se=a(532),ie=a.n(se);a(1023);function le(e){if(e instanceof File)return e.webkitRelativePath;if(e instanceof String||"string"===typeof e)return e;throw new Error("Expected either a File or string")}class oe{constructor(e,t){if(this.tags={},this.sets={},this.prefix="textures/",e){for(var a=0,n=Object.entries(e.tags);a<n.length;a++){const e=Object($.a)(n[a],2),t=e[0];let s=e[1].map(e=>{let t=e;return e.startsWith(this.prefix)||(t=this.prefix+t),t});this.setFilesForTag(t,s,!0)}"object"===typeof e.sets&&(this.sets=e.sets)}}clone(){return new oe(this)}changeFilePrefix(e){for(var t=0,a=Object.entries(this.tags);t<a.length;t++){const n=Object($.a)(a[t],2),s=n[0],i=n[1];this.tags[s]=i.map(t=>{let a=t;return a=t.startsWith(this.prefix)?t.replace(this.prefix,e):e+a,a})}this.prefix=e}toJSON(){return{tags:this.tags,sets:this.sets}}getTagList(){return Object.keys(this.tags)}getPathListForTagWithoutPrefix(e){if(L.log("TagData:getPathListForTagWithoutPrefix"),this.tagExists(e)){let t=this.tags[e].map(e=>e.startsWith(this.prefix)?e.replace(this.prefix,""):e);return L.log("  -> returning pathList",t),t}return L.log("  -> Tag does not exist"),[]}tagExists(e){return e in this.tags}addTag(e){if(L.log("TagData:addTag"),L.log("  -> newTag",e),e in this.tags)return L.log("  -> Already exists, returning early..."),void(Array.isArray(this.tags[e])||(L.log("  -> Wasn't an array, setting to an empty array"),this.tags[e]=[]));this.tags[e]=[],this.tags=ie()(ne()(te()(this.tags)))}removeTag(e){delete this.tags[e]}addFilesToTag(e,t){this.addTag(e);let a=this.tags[e];t.forEach(e=>{let t=this.prefix+le(e);a.includes(t)||a.push(t)}),a.sort(),this.tags[e]=a}setFilesForTag(e,t,a){L.time("TagData:setFilesForTag"),this.addTag(e);let n=[];t.forEach(e=>{n.push((a?"":this.prefix)+le(e))}),n=Q()(n),n.sort(),this.tags[e]=n,L.timeEnd("TagData:setFilesForTag")}removeFilesFromTag(e,t){this.addTag(e);let a=this.tags[e],n=[];t.forEach(e=>{n.push(this.prefix+le(e))}),Z()(a,n),a.sort()}}var re=oe;a(1046),a(1047);var he=function(e){return s.a.createElement("input",{id:"myTagFileInput",type:"file",onChange:function(t){e.onChange(t.target.files)}})};function ge(e){return"string"===typeof e&&!v()(e.trim())}class ce extends s.a.Component{constructor(e){super(e),L.ENABLE_LOGGING=!0;let t=new URLSearchParams(window.location.search).get("forceLogging");!t||"true"!==t&&"false"!==t||(L.ENABLE_LOGGING=Boolean(t)),L.log("App:constructor"),L.log("  -> Logger.ENABLE_LOGGING: ",L.ENABLE_LOGGING),this.state={objectsDirFiles:[],tag:null,tagsFileContents:new re},L.log("  -> this.state.tagsFileContents: ",this.state.tagsFileContents),this.handleObjectsDirChange=this.handleObjectsDirChange.bind(this),this.addNewTagAndSetCurrent=this.addNewTagAndSetCurrent.bind(this),this.associateFilesToCurrentTag=this.associateFilesToCurrentTag.bind(this),this.handleTagChange=this.handleTagChange.bind(this),this.handleInputTagsFileChange=this.handleInputTagsFileChange.bind(this)}handleObjectsDirChange(e){L.log("App:handleObjectsDirChange"),this.setState((t,a)=>({objectsDirFiles:[...e]}))}handleInputTagsFileChange(e){if(L.log("App:handleInputTagsFileChange"),!e.length)return;let t=e[0],a=new FileReader;var n=this;a.onload=function(e){L.log("  ->event.target.result",e.target.result),window.foo=e.target.result,L.log("  ->typeof event.target.result",typeof e.target.result),L.log("  ->JSON.parse(event.target.result",JSON.parse(e.target.result));const t=new re(JSON.parse(e.target.result)),a=Object.keys(t.tags);let s=a.length>0?a[0]:null;n.setState((e,a)=>({tagsFileContents:t,tag:s}))},a.readAsText(t)}addNewTagAndSetCurrent(e){L.log("App:addNewTagAndSetCurrent");let t=this.state.tagsFileContents.clone();t.addTag(e),this.setState((a,n)=>({tagsFileContents:t,tag:e}))}handleTagChange(e){this.setState((t,a)=>({tag:e}))}associateFilesToCurrentTag(e){if(L.log("App:this.associateFilesToCurrentTag"),!ge(this.state.tag))return void L.log("  -> No tag, returning early");L.time("App:this.associateFilesToCurrentTag");let t=this.state.tagsFileContents.clone();t.setFilesForTag(this.state.tag,e),L.log("  -> about to update tags file. new data: ",t),this.setState((e,a)=>({tagsFileContents:t})),L.timeEnd("App:this.associateFilesToCurrentTag")}render(){let e,t,a,n=Object.keys(this.state.tagsFileContents.tags),i=ge(this.state.tag);if(this.state.objectsDirFiles&&this.state.objectsDirFiles.length>0){const l=this.state.tagsFileContents.getPathListForTagWithoutPrefix(this.state.tag);e=s.a.createElement(r.a,null,s.a.createElement(h.a,null,s.a.createElement(g.a,{variant:"h2"},"Select Tag"),s.a.createElement(_,{tag:this.state.tag,onTagChange:this.handleTagChange,tagList:n,onNewTag:this.addNewTagAndSetCurrent}))),t=s.a.createElement(r.a,null,s.a.createElement(h.a,null,s.a.createElement(g.a,{variant:"h2"},"Tag/Untag Files"),s.a.createElement(k,{files:this.state.objectsDirFiles,alreadyChosenPaths:l,onSelectionChange:this.associateFilesToCurrentTag,canSelect:i}))),a=s.a.createElement(r.a,null,s.a.createElement(h.a,null,s.a.createElement(g.a,{variant:"h2"},"File Preview"),s.a.createElement(K,{contents:this.state.tagsFileContents})))}return s.a.createElement(c.a,{maxWidth:"xl"},s.a.createElement(g.a,{variant:"h1",color:"primary"},"Dungeondraft Tag App"),s.a.createElement(u.a,null),s.a.createElement(d.a,null,s.a.createElement(p.a,null,s.a.createElement(m.a,{expandIcon:s.a.createElement(b.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},s.a.createElement(C.a,{color:"primary"}),s.a.createElement(g.a,{color:"textPrimary",className:"App-accordion-header"}," Info"),s.a.createElement(g.a,{color:"textSecondary",align:"center"},"Bugs, browser support, privacy, and source code")),s.a.createElement(f.a,{severity:"warning"},"Please note that this app is in beta - there are likely to be bugs. If you come across any, let me know at ",s.a.createElement("a",{href:"https://github.com/Oblongmana/dungeondraft-tag-app/issues"},"https://github.com/Oblongmana/dungeondraft-tag-app/issues"),". (Really it was one-day hack to relearn React and start learning material-ui, as you can tell from the simplistic UI",s.a.createElement(w.a,null),")"),s.a.createElement(f.a,{severity:"warning"},"Please note that this app uses functionality that is not supported by all browsers, though is supported by most modern desktop browsers. If you see this message - you're likely using a modern browser! If you run into any issues though, see the issue reporting link above."),s.a.createElement(f.a,{severity:"info"},"Your files will remain private, and will not be uploaded to any servers, or in any way transmitted anywhere - but feel free to verify this yourself! Source code can be viewed at ",s.a.createElement("a",{href:"https://github.com/Oblongmana/dungeondraft-tag-app"},"https://github.com/Oblongmana/dungeondraft-tag-app"),"."))),s.a.createElement(u.a,null),s.a.createElement(r.a,null,s.a.createElement(h.a,null,s.a.createElement(g.a,{variant:"h2"},"Choose Existing Tag File (Optional)"),s.a.createElement("p",{style:{fontWeight:"bold"}},"Choose your existing tag file, or proceed without selecting one if you want to create a new one from scratch. You can return here if you change your mind, but note that if you do, loading a tag file will overwrite any selections you've already made."),s.a.createElement("p",{style:{fontWeight:"bold"}},"Please note that the tag file will be reconciled with your selections, so if the tag file refers to objects that aren't in the directory you select, those will not be included in the output file"),s.a.createElement(f.a,{severity:"warning"},"The app does not handle Sets at present, but will not break any Sets already present in your tag file."),s.a.createElement("p",null,s.a.createElement(he,{onChange:this.handleInputTagsFileChange})))),s.a.createElement(r.a,null,s.a.createElement(h.a,null,s.a.createElement(g.a,{variant:"h2"},"Choose Folder"),s.a.createElement("p",{style:{fontWeight:"bold"}},'Choose your objects folder (must be directly inside the "textures" folder)'),s.a.createElement("p",null,s.a.createElement(O,{onChange:this.handleObjectsDirChange})))),e,t,a)}}var ue=ce;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(o.a,null),s.a.createElement(ue,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},545:function(e,t,a){e.exports=a(1048)},653:function(e,t,a){},654:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},668:function(e,t,a){},759:function(e,t,a){},760:function(e,t,a){},761:function(e,t,a){}},[[545,1,2]]]);
//# sourceMappingURL=main.b8ec0e01.chunk.js.map